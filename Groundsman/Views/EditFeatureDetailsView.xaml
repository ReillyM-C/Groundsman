<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Groundsman.EditFeatureDetailsView"
             xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ios="clr-namespace:Xamarin.Forms.PlatformConfiguration.iOSSpecific;assembly=Xamarin.Forms.Core"
             x:Name="EditFeatureDetailsViewPage"
             ios:Page.ModalPresentationStyle="FormSheet"
             BackgroundColor="{DynamicResource bgPrimary}">
    <ContentPage.Resources>
        <DataTemplate x:Key="HeaderTemplate">
            <StackLayout>
                <Frame Padding="10,10,0,10"
                       BackgroundColor="{DynamicResource bgPrimary}"
                       CornerRadius="10"
                       HasShadow="False">
                    <StackLayout>
                        <Label Style="{StaticResource ViewLabelStyle}" Text="Feature Properties" />
                        <Entry x:Name="nameEntry"
                               FontSize="Small"
                               Placeholder="Name"
                               Style="{StaticResource EntryStyle}"
                               Text="{Binding NameEntry}" />
                        <BoxView BackgroundColor="WhiteSmoke"
                                 HeightRequest="1"
                                 VerticalOptions="End" />
                        <DatePicker x:Name="dateEntry"
                                    Date="{Binding DateEntry, StringFormat='{0:dd/MM/yyyy}'}"
                                    FontSize="Small"
                                    Style="{StaticResource DateEntryStyle}" />
                    </StackLayout>
                </Frame>

                <Frame Margin="0,10,0,0"
                       Padding="10,10,0,10"
                       BackgroundColor="{DynamicResource bgPrimary}"
                       CornerRadius="10"
                       HasShadow="False">
                    <StackLayout>

                        <Grid ColumnDefinitions="*,*" RowDefinitions="*">
                            <Label Grid.Column="0"
                                   Style="{StaticResource ViewLabelStyle}"
                                   Text="Geolocation Data" />
                            <Button Grid.Column="1"
                                    Margin="0,0,10,0"
                                    FontSize="16"
                                    HeightRequest="10"
                                    HorizontalOptions="End"
                                    Text="Edit"
                                    VerticalOptions="Center">
                                <Button.TextColor>
                                    <OnPlatform x:TypeArguments="Color"
                                                Android="{StaticResource textSecondary}"
                                                iOS="{StaticResource greenPrimary}" />
                                </Button.TextColor>
                                <Button.BackgroundColor>
                                    <OnPlatform x:TypeArguments="Color" Android="{StaticResource bgSecondary}" />
                                </Button.BackgroundColor>
                            </Button>
                        </Grid>

                        <Grid ColumnDefinitions=".7*,5*,5*,3*,1.3*" Style="{StaticResource DetailFormPanelGrid}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Label Grid.Row="0"
                                   Grid.Column="0"
                                   Margin="0,9"
                                   AutomationId="LatLabel"
                                   FontSize="Small"
                                   Style="{StaticResource ViewLabelStyle}"
                                   Text="#" />
                            <Label Grid.Row="0"
                                   Grid.Column="1"
                                   Margin="6,9"
                                   AutomationId="LatLabel"
                                   FontSize="Small"
                                   Style="{StaticResource ViewLabelStyle}"
                                   Text="Latitude" />
                            <Label Grid.Row="0"
                                   Grid.Column="2"
                                   Margin="6,9"
                                   AutomationId="LongLabel"
                                   FontSize="Small"
                                   Style="{StaticResource ViewLabelStyle}"
                                   Text="Longitude" />
                            <Label Grid.Row="0"
                                   Grid.Column="3"
                                   Margin="6,9"
                                   AutomationId="AltLabel"
                                   FontSize="Small"
                                   Style="{StaticResource ViewLabelStyle}"
                                   Text="Altitude" />
                        </Grid>
                    </StackLayout>
                </Frame>
            </StackLayout>


        </DataTemplate>
        <DataTemplate x:Key="ItemTemplate">
            <SwipeView>
                <SwipeView.RightItems>
                    <SwipeItems Mode="Reveal">
                        <SwipeItem BackgroundColor="Red"
                                   Command="{Binding Source={x:Reference GeodataList}, Path=BindingContext.DeletePointCommand}"
                                   CommandParameter="{Binding .}"
                                   Text="Delete" />
                    </SwipeItems>
                </SwipeView.RightItems>
                <SwipeView.Content>
                    <Grid Margin="0,5"
                          Padding="10,0,0,0"
                          ColumnDefinitions=".7*,5*,5*,3*,1.3*"
                          IsEnabled="{Binding Path=BindingContext.GeolocationEntryEnabled, Source={x:Reference Name=EditFeatureDetailsViewPage}}"
                          RowDefinitions="*,1"
                          Style="{StaticResource DetailFormPanelGrid}">
                        <Label Grid.Row="0"
                               Grid.Column="0"
                               FontSize="Small"
                               Style="{StaticResource ViewLabelStyle}"
                               Text="{Binding Index}"
                               VerticalOptions="Center" />
                        <Frame Grid.Row="0"
                               Grid.Column="1"
                               Padding="0"
                               BackgroundColor="{DynamicResource bgPrimary}"
                               CornerRadius="5"
                               HasShadow="False"
                               HorizontalOptions="FillAndExpand">
                            <Entry FontSize="Small"
                                   Keyboard="Numeric"
                                   Style="{StaticResource EntryStyle}"
                                   Text="{Binding Latitude}" />
                        </Frame>
                        <Frame Grid.Row="0"
                               Grid.Column="2"
                               Padding="0"
                               BackgroundColor="{DynamicResource bgPrimary}"
                               CornerRadius="5"
                               HasShadow="False"
                               HorizontalOptions="FillAndExpand">
                            <Entry AutomationId="AltitudeEntry"
                                   FontSize="Small"
                                   Keyboard="Numeric"
                                   Style="{StaticResource EntryStyle}"
                                   Text="{Binding Longitude}" />
                        </Frame>
                        <Frame Grid.Row="0"
                               Grid.Column="3"
                               Padding="0"
                               BackgroundColor="{DynamicResource bgPrimary}"
                               CornerRadius="5"
                               HasShadow="False"
                               HorizontalOptions="FillAndExpand"
                               VerticalOptions="Center">
                            <Entry AutomationId="AltitudeEntry"
                                   FontSize="Small"
                                   Keyboard="Numeric"
                                   Style="{StaticResource EntryStyle}"
                                   Text="{Binding Altitude}" />
                        </Frame>

                        <ActivityIndicator Grid.Row="0"
                                           Grid.Column="4"
                                           IsRunning="{Binding Path=BindingContext.LoadingIconActive, Source={x:Reference Name=EditFeatureDetailsViewPage}}"
                                           IsVisible="{Binding Path=BindingContext.LoadingIconActive, Source={x:Reference Name=EditFeatureDetailsViewPage}}"
                                           VerticalOptions="Center"
                                           Color="{StaticResource greenPrimary}" />
                        <Button Grid.Row="0"
                                Grid.Column="4"
                                BackgroundColor="Transparent"
                                Command="{Binding Path=BindingContext.GetFeatureCommand, Source={x:Reference Name=EditFeatureDetailsViewPage}}"
                                CommandParameter="{Binding .}"
                                HeightRequest="20"
                                HorizontalOptions="Start"
                                Image="current_location"
                                IsEnabled="{Binding Path=BindingContext.GeolocationEntryEnabled, Source={x:Reference Name=EditFeatureDetailsViewPage}}"
                                VerticalOptions="CenterAndExpand" />
                        <BoxView Grid.Row="1"
                                 Grid.Column="1"
                                 Grid.ColumnSpan="4"
                                 BackgroundColor="WhiteSmoke"
                                 HeightRequest="1"
                                 VerticalOptions="End" />
                    </Grid>
                </SwipeView.Content>
            </SwipeView>
        </DataTemplate>
        <DataTemplate x:Key="FooterTemplate">
            <StackLayout>
                <Frame Padding="0" HasShadow="False">
                    <StackLayout>

                        <Grid Padding="10,0,0,0"
                              ColumnDefinitions=".7*,5*,5*,3*,1.3*"
                              IsVisible="{Binding EditingPolygon}"
                              RowDefinitions="*,*"
                              Style="{StaticResource DetailFormPanelGrid}">
                            <Label Grid.Row="0"
                                   Grid.Column="0"
                                   FontSize="Small"
                                   Style="{StaticResource ViewLabelStyle}"
                                   Text="{Binding NumPointFields}"
                                   VerticalOptions="Center" />
                            <Frame Grid.Row="0"
                                   Grid.Column="1"
                                   Padding="0"
                                   BackgroundColor="{DynamicResource bgPrimary}"
                                   CornerRadius="5"
                                   HasShadow="False"
                                   HorizontalOptions="FillAndExpand">
                                <Entry AutomationId="AltitudeEntry"
                                       FontSize="Small"
                                       IsEnabled="False"
                                       Style="{StaticResource EntryStyle}"
                                       Text="{Binding GeolocationValues[0].Latitude}" />
                            </Frame>
                            <Frame Grid.Row="0"
                                   Grid.Column="2"
                                   Padding="0"
                                   BackgroundColor="{DynamicResource bgPrimary}"
                                   CornerRadius="5"
                                   HasShadow="False"
                                   HorizontalOptions="FillAndExpand">
                                <Entry AutomationId="AltitudeEntry"
                                       FontSize="Small"
                                       IsEnabled="False"
                                       Style="{StaticResource EntryStyle}"
                                       Text="{Binding GeolocationValues[0].Longitude}" />
                            </Frame>
                            <Frame Grid.Row="0"
                                   Grid.Column="3"
                                   Padding="0"
                                   BackgroundColor="{DynamicResource bgPrimary}"
                                   CornerRadius="5"
                                   HasShadow="False"
                                   HorizontalOptions="FillAndExpand"
                                   VerticalOptions="Center">
                                <Entry AutomationId="AltitudeEntry"
                                       FontSize="Small"
                                       IsEnabled="False"
                                       Style="{StaticResource EntryStyle}"
                                       Text="{Binding GeolocationValues[0].Altitude}" />
                            </Frame>
                        </Grid>
                        <Frame Grid.Row="1"
                               Grid.ColumnSpan="4"
                               Margin="10"
                               Padding="8"
                               BackgroundColor="Transparent"
                               CornerRadius="8"
                               HasShadow="False"
                               HeightRequest="20"
                               HorizontalOptions="CenterAndExpand">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding AddPointCommand}" CommandParameter="File" />
                            </Frame.GestureRecognizers>
                            <StackLayout Orientation="Horizontal" VerticalOptions="Center">
                                <Image HorizontalOptions="Center"
                                       Source="add_icon_color"
                                       VerticalOptions="Center" />
                                <Label FontSize="Small"
                                       HorizontalOptions="Center"
                                       Text="Add Point"
                                       TextColor="Green"
                                       VerticalOptions="Center" />
                            </StackLayout>
                        </Frame>
                    </StackLayout>
                </Frame>
                <Frame Margin="0,10,0,180"
                       Padding="10,10,0,10"
                       BackgroundColor="{DynamicResource bgPrimary}"
                       CornerRadius="10"
                       HasShadow="False">
                    <StackLayout>
                        <Label Style="{StaticResource ViewLabelStyle}" Text="Metadata" />
                        <StackLayout Orientation="Vertical">
                            <Entry x:Name="nameEntry"
                                   FontSize="Small"
                                   Placeholder="String"
                                   Style="{StaticResource EntryStyle}"
                                   Text="{Binding MetadataStringEntry}" />
                            <BoxView BackgroundColor="WhiteSmoke"
                                     HeightRequest="1"
                                     VerticalOptions="End" />
                            <Entry x:Name="integerEntry"
                                   FontSize="Small"
                                   Placeholder="Integer"
                                   Style="{StaticResource EntryStyle}"
                                   Text="{Binding MetadataIntegerEntry}" />
                            <BoxView BackgroundColor="WhiteSmoke"
                                     HeightRequest="1"
                                     VerticalOptions="End" />
                            <Entry x:Name="floatEntry"
                                   FontSize="Small"
                                   Placeholder="Float"
                                   Style="{StaticResource EntryStyle}"
                                   Text="{Binding MetadataFloatEntry}" />
                        </StackLayout>

                    </StackLayout>
                </Frame>
            </StackLayout>

        </DataTemplate>
    </ContentPage.Resources>
    <ContentPage.Content>
        <StackLayout BackgroundColor="{DynamicResource bgSecondary}">
            <StackLayout BackgroundColor="{DynamicResource bgPrimary}">
                <Grid Margin="15,7,15,0" BackgroundColor="{DynamicResource bg}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Button x:Name="cancelButton"
                            Grid.Row="0"
                            Grid.Column="0"
                            Command="{Binding OnDismissCommand}"
                            FontSize="16"
                            HorizontalOptions="Start"
                            Text="Cancel">
                        <Button.TextColor>
                            <OnPlatform x:TypeArguments="Color"
                                        Android="{StaticResource textSecondary}"
                                        iOS="{StaticResource greenPrimary}" />
                        </Button.TextColor>
                        <Button.BackgroundColor>
                            <OnPlatform x:TypeArguments="Color" Android="{StaticResource bgSecondary}" />
                        </Button.BackgroundColor>
                    </Button>
                    <Label Grid.Row="0"
                           Grid.Column="1"
                           FontAttributes="Bold"
                           FontSize="16"
                           HorizontalOptions="Center"
                           Text="Edit Feature"
                           TextColor="{DynamicResource textPrimary}"
                           VerticalOptions="Center" />
                    <Button x:Name="saveButton"
                            Grid.Row="0"
                            Grid.Column="2"
                            Command="{Binding OnSaveUpdatedCommand}"
                            FontAttributes="Bold"
                            FontSize="16"
                            HorizontalOptions="End"
                            Text="Done">
                        <Button.TextColor>
                            <OnPlatform x:TypeArguments="Color"
                                        Android="{StaticResource textSecondary}"
                                        iOS="{StaticResource greenPrimary}" />
                        </Button.TextColor>
                        <Button.BackgroundColor>
                            <OnPlatform x:TypeArguments="Color" Android="{StaticResource bgSecondary}" />
                        </Button.BackgroundColor>
                    </Button>
                </Grid>
                <BoxView HeightRequest="0.3" Color="{DynamicResource bgTertiary}" />
            </StackLayout>
            <Frame Style="{StaticResource FrameStyle}">

                <CollectionView x:Name="GeodataList"
                                Footer="{Binding .}"
                                FooterTemplate="{StaticResource FooterTemplate}"
                                Header="{Binding .}"
                                HeaderTemplate="{StaticResource HeaderTemplate}"
                                ItemTemplate="{StaticResource ItemTemplate}"
                                ItemsSource="{Binding GeolocationValues}" />

            </Frame>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>