<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Groundsman.EditFeatureDetailsView"
             x:Name="EditFeatureDetailsViewPage"
             xmlns:ios="clr-namespace:Xamarin.Forms.PlatformConfiguration.iOSSpecific;assembly=Xamarin.Forms.Core"
             xmlns:control="clr-namespace:Plugin.Segmented.Control;assembly=Plugin.Segmented"
             ios:Page.ModalPresentationStyle="FormSheet"
             Title=""
             BackgroundColor="{DynamicResource bgPrimary}">
    <ContentPage.Content>
        <StackLayout>
            <Grid Margin="15, 7, 15, 0" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Button x:Name="cancelButton" Text="Cancel" FontSize="16"  HorizontalOptions="Start" Grid.Row="0" Grid.Column="0" Command="{Binding OnDismissCommand}">
                    <Button.TextColor>
                        <OnPlatform x:TypeArguments="Color" iOS="{StaticResource greenPrimary}" Android="White" />
                    </Button.TextColor>
                </Button>
                <Label Text="Edit Feature" TextColor="{DynamicResource textPrimary}" FontSize="16"  FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" Grid.Row="0" Grid.Column="1" />
                <Button x:Name="addButton" Text="Add" FontSize="16" FontAttributes="Bold"  HorizontalOptions="End" Grid.Row="0" Grid.Column="2" Command="{Binding OnSaveUpdatedCommand}">
                    <Button.TextColor>
                        <OnPlatform x:TypeArguments="Color" iOS="{StaticResource greenPrimary}" Android="White" />
                    </Button.TextColor>
                </Button>
            </Grid>
            <control:SegmentedControl x:Name="SegmentedControl" SelectedSegment="{Binding SegmentSelection}" TintColor="{StaticResource textPrimary}" SelectedTextColor="{StaticResource greenPrimary}" DisabledColor="Gray" Margin="8,8,8,8">
                <control:SegmentedControl.Children>
                    <control:SegmentedControlOption Text="Point" />
                    <control:SegmentedControlOption Text="Line" />
                    <control:SegmentedControlOption Text="Polygon" />
                </control:SegmentedControl.Children>
            </control:SegmentedControl>
            <TableView BackgroundColor="{DynamicResource bgPrimary}" Intent="Settings" HasUnevenRows="True">
                <TableRoot>
                    <TableSection Title="Properties">
                        <ViewCell>
                            <Entry AutomationId="nameEntry" x:Name="nameEntry" Text="{Binding NameEntry}" Placeholder="Name of item" ClearButtonVisibility="WhileEditing" />
                        </ViewCell>
                    </TableSection>
                    <TableSection Title="Metadata">
                        <EntryCell AutomationId="stringEntry" x:Name="stringEntry" Text="{Binding MetadataStringEntry}" Placeholder="String" />
                        <EntryCell AutomationId="integerEntry" x:Name="integerEntry" Text="{Binding MetadataIntegerEntry}" Keyboard="Numeric"/>
                        <EntryCell AutomationId="floatEntry" x:Name="floatEntry" Text="{Binding MetadataFloatEntry}" Keyboard="Numeric"/>
                    </TableSection>

                    <TableSection Title="Geolocation Data">
                        <ViewCell>
                            <Button AutomationId="addGeoPoint" x:Name="addPointBtn" Command="{Binding AddPointCommand}" Grid.Row="0" Grid.Column="1" FontSize="Small" HeightRequest="50" WidthRequest="50" HorizontalOptions="End" />
                        </ViewCell>
                        <ViewCell AutomationId="listCell" x:Name="listCell">
                            <StackLayout BindableLayout.ItemsSource="{Binding GeolocationPoints}" AutomationId="geolocationListView" x:Name="geolocationListView" VerticalOptions="FillAndExpand">
                                <BindableLayout.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Style="{StaticResource DetailFormPanelGrid}" IsEnabled="{Binding Path=BindingContext.GeolocationEntryEnabled, Source={x:Reference Name=EditFeatureDetailsViewPage}}" Margin="10,0,0,0">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer  />
                                            </Grid.GestureRecognizers>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                                <ColumnDefinition />
                                                <ColumnDefinition Width="32" />
                                            </Grid.ColumnDefinitions>
                                            <Label Style="{StaticResource ViewLabelStyle}" AutomationId="LatLabel" Text="Latitude" Grid.Row="0" Grid.Column="0" Margin="0, 9" FontSize="Small" />
                                            <Entry Style="{StaticResource EntryStyle}" AutomationId="LatitudeEntry" Text="{Binding Latitude}" Keyboard="Numeric" Grid.Row="1" Grid.Column="0" FontSize="Small" Margin="0,0,0,10"/>
                                            <Label Style="{StaticResource ViewLabelStyle}" AutomationId="LongLabel" Text="Longitude" Grid.Row="0" Grid.Column="1" Margin="0, 9" FontSize="Small" />
                                            <Entry Style="{StaticResource EntryStyle}" AutomationId="LongitudeEntry" Text="{Binding Longitude}" Keyboard="Numeric" Grid.Row="1" Grid.Column="1" FontSize="Small" Margin="0,0,0,10"/>
                                            <Label Style="{StaticResource ViewLabelStyle}" AutomationId="AltLabel" Text="Altitude" Grid.Row="0" Grid.Column="2" Margin="0, 9" FontSize="Small" />
                                            <Entry Style="{StaticResource EntryStyle}" AutomationId="AltitudeEntry" Text="{Binding Altitude}" Keyboard="Numeric" Grid.Row="1" Grid.Column="2" FontSize="Small" Margin="0,0,0,10"/>
                                            <Button Command="{Binding Path=BindingContext.DeletePointCommand, Source={x:Reference Name=EditFeatureDetailsViewPage}}" CommandParameter="{Binding .}" IsEnabled="{Binding Path=BindingContext.GeolocationEntryEnabled, Source={x:Reference Name=EditFeatureDetailsViewPage}}" Image="trash_icon_color" Grid.Row="0" Grid.Column="3" WidthRequest="20" HeightRequest="20" IsVisible="{Binding Path=BindingContext.ShowPointDeleteBtn, Source={x:Reference Name=EditFeatureDetailsViewPage}}" FontSize="Small" />
                                            <ActivityIndicator Grid.Row="1" Grid.Column="3" Color="{StaticResource greenPrimary}" IsRunning="{Binding Path=BindingContext.LoadingIconActive, Source={x:Reference Name=EditFeatureDetailsViewPage}}" IsVisible="{Binding Path=BindingContext.LoadingIconActive, Source={x:Reference Name=EditFeatureDetailsViewPage}}" />
                                            <Button Command="{Binding Path=BindingContext.GetFeatureCommand, Source={x:Reference Name=EditFeatureDetailsViewPage}}" CommandParameter="{Binding .}" IsEnabled="{Binding Path=BindingContext.GeolocationEntryEnabled, Source={x:Reference Name=EditFeatureDetailsViewPage}}" Image="current_location" Grid.Row="1" Grid.Column="3" WidthRequest="20" HeightRequest="20" Margin="0,0,0,10" />
                                        </Grid>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </StackLayout>
                        </ViewCell>
                    </TableSection>
                </TableRoot>
            </TableView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>